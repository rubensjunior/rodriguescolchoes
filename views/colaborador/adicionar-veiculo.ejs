<!-- Wappler include head-page="layouts/mobile-portaria" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="adicionarveiculo" appConnect="local" components="{dmxValidator:{}}" -->
<meta name="ac:route" content="/colaborador/f/adicionar-veiculo">

<div class="container-fluid py-4">
    <!-- Header da p√°gina -->
    <div class="row justify-content-center mb-4">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="text-center">
                <h2 class="mb-2">
                    <i class="fas fa-car me-2 text-primary"></i>
                    Adicionar Ve√≠culo
                </h2>
                <p class="text-secondary mb-0">Cadastre um novo ve√≠culo ao seu perfil</p>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8 col-xl-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-3 p-md-4">
                    <form is="dmx-serverconnect-form" id="adicionar_veiculo_form" class="needs-validation" method="post" action="/api/colaborador/cadastrar-veiculo" dmx-on:error="notificacao.danger('Ocorreu um erro!')" dmx-on:success="run([{run:{outputType:'text',action:`notificacao.success(\'Cadastrado com sucesso!\');adicionar_veiculo_form.reset()`}},{wait:{delay:2000}},{run:{outputType:'text',action:`navegacao.goto(\'/colaborador/f/\')`}}])">


                        <!-- Dados do Ve√≠culo -->
                        <div class="step-content">
                            <div class="row g-3">
                                <!-- Tipo do Ve√≠culo -->
                                <div class="col-12 col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="tipo_veiculo" class="form-label">
                                            <i class="fas fa-car-side me-1"></i>
                                            Tipo do ve√≠culo *
                                        </label>
                                        <select id="tipo_veiculo" name="tipo_veiculo" class="form-select" required data-msg-required="Por favor, selecione o tipo do ve√≠culo">
                                            <option value="" selected disabled>Selecione o tipo</option>
                                            <option value="carro">üöó Carro</option>
                                            <option value="moto">üèçÔ∏è Moto</option>
                                            <option value="caminhao">üöö Caminh√£o</option>
                                            <option value="van">üöê Van</option>
                                            <option value="outros">üöô Outros</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Placa -->
                                <div class="col-12 col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="placa" class="form-label">
                                            <i class="fas fa-id-card me-1"></i>
                                            Placa do ve√≠culo *
                                        </label>
                                        <input type="text" class="form-control text-uppercase" id="placa" name="placa" placeholder="ABC1234" required data-msg-required="Por favor, digite a placa do ve√≠culo" maxlength="8">
                                        <div class="form-text">Formato: ABC1234 ou ABC1C34</div>
                                    </div>
                                </div>

                                <!-- Modelo do Ve√≠culo -->
                                <div class="col-12 col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="modelo_veiculo" class="form-label">
                                            <i class="fas fa-tag me-1"></i>
                                            Modelo
                                        </label>
                                        <input type="text" class="form-control" id="modelo_veiculo" name="modelo_veiculo" placeholder="Ex: Honda Civic, Yamaha Factor, etc.">
                                        <div class="form-text">Campo opcional</div>
                                    </div>
                                </div>

                                <!-- Ano do Ve√≠culo -->
                                <div class="col-12 col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="ano_veiculo" class="form-label">
                                            <i class="fas fa-calendar me-1"></i>
                                            Ano
                                        </label>
                                        <input type="number" class="form-control" id="ano_veiculo" name="ano_veiculo" placeholder="2020" min="1900" max="2030">
                                        <div class="form-text">Campo opcional</div>
                                    </div>
                                </div>

                                <!-- Cor do Ve√≠culo -->
                                <div class="col-12">
                                    <div class="form-group mb-3">
                                        <label for="cor_veiculo" class="form-label">
                                            <i class="fas fa-palette me-1"></i>
                                            Cor do ve√≠culo
                                        </label>
                                        <input type="text" class="form-control" id="cor_veiculo" name="cor_veiculo" placeholder="Ex: Branco, Prata, Azul">
                                        <div class="form-text">Campo opcional - ajuda na identifica√ß√£o</div>
                                    </div>
                                </div>

                                <!-- Observa√ß√µes -->
                                <div class="col-12">
                                    <div class="form-group mb-3">
                                        <label for="observacoes" class="form-label">
                                            <i class="fas fa-sticky-note me-1"></i>
                                            Observa√ß√µes
                                        </label>
                                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3" placeholder="Ex: Adesivos, caracter√≠sticas especiais, etc."></textarea>
                                        <div class="form-text">Informa√ß√µes adicionais sobre o ve√≠culo (opcional)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bot√µes de A√ß√£o -->
                        <div class="form-navigation mt-4">
                            <div class="row g-2 g-md-3">
                                <!-- Bot√£o Cancelar -->
                                <div class="col-6">
                                    <button type="button" class="btn btn-outline-secondary w-100" dmx-on:click="browser1.goto('/colaborador/inicial-colaborador', true)">
                                        <i class="fas fa-times me-1 d-none d-sm-inline"></i>
                                        <span class="d-none d-sm-inline">Cancelar</span>
                                        <span class="d-sm-none"><i class="fas fa-times"></i></span>
                                    </button>
                                </div>
                                <!-- Bot√£o Adicionar -->
                                <div class="col-6">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <span dmx-hide="adicionar_veiculo_form.state.executing">
                                            <i class="fas fa-plus me-1 d-none d-sm-inline"></i>
                                            <span class="d-none d-sm-inline">Adicionar Ve√≠culo</span>
                                            <span class="d-sm-none">Adicionar</span>
                                        </span>
                                        <span dmx-show="adicionar_veiculo_form.state.executing">
                                            <span class="spinner-border spinner-border-sm me-2"></span>
                                            <span class="d-none d-sm-inline">Adicionando...</span>
                                            <span class="d-sm-none">...</span>
                                        </span>
                                    </button>
                                </div><input id="usuario" name="usuario" type="hidden" class="form-control" dmx-bind:value="usuario_logado.data.identity">
                            </div>
                        </div>

                    </form>

                    <!-- Mensagens de Status -->
                    <div class="mt-3">
                        <!-- Sucesso -->
                        <div dmx-show="adicionar_veiculo_form.data.success" class="alert alert-success border-0">
                            <i class="fas fa-check-circle me-2"></i>
                            <span dmx-text="adicionar_veiculo_form.data.message || 'Ve√≠culo adicionado com sucesso!'"></span>
                        </div>

                        <!-- Erro -->
                        <div dmx-show="adicionar_veiculo_form.lastError" class="alert alert-danger border-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span dmx-text="adicionar_veiculo_form.lastError.message || 'Ocorreu um erro ao adicionar o ve√≠culo. Tente novamente.'"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Componente Browser para navega√ß√£o -->
<dmx-browser id="browser1"></dmx-browser>

<script>
    // Formata√ß√£o de placa em tempo real
    document.addEventListener('DOMContentLoaded', function() {
        const placaInput = document.getElementById('placa');
        const modeloInput = document.getElementById('modelo_veiculo');
        const corInput = document.getElementById('cor_veiculo');
        
        // M√°scara para placa - aceita formato antigo (ABC1234) e Mercosul (ABC1C34)
        if (placaInput) {
            placaInput.addEventListener('input', function() {
                let valor = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                
                if (valor.length <= 7) {
                    // Formato antigo ABC1234
                    valor = valor.replace(/^([A-Z]{0,3})([0-9]{0,4})$/, '$1$2');
                } else if (valor.length === 8) {
                    // Formato Mercosul ABC1C34
                    valor = valor.replace(/^([A-Z]{3})([0-9]{1})([A-Z]{1})([0-9]{2})$/, '$1$2$3$4');
                }
                
                this.value = valor;
            });
        }
        
        // Auto-capitalize para modelo do ve√≠culo (primeira letra de cada palavra)
        /*if (modeloInput) {
            modeloInput.addEventListener('input', function() {
                let valor = this.value;
                valor = valor.toLowerCase().replace(/\b\w/g, function(l) {
                    return l.toUpperCase();
                });
                this.value = valor;
            });
        }*/
        
        // Auto-capitalize para cor do ve√≠culo
        if (corInput) {
            corInput.addEventListener('input', function() {
                let valor = this.value;
                valor = valor.toLowerCase().replace(/\b\w/g, function(l) {
                    return l.toUpperCase();
                });
                this.value = valor;
            });
        }

        // Debug
        console.log('P√°gina Adicionar Ve√≠culo carregada');
        console.log('Formul√°rio:', document.getElementById('adicionar_veiculo_form'));
        console.log('App Connect:', typeof dmx !== 'undefined' ? 'Carregado' : 'N√£o carregado');
        console.log('Bootstrap:', typeof bootstrap !== 'undefined' ? 'Carregado' : 'N√£o carregado');
    });
</script>