<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="index" appConnect="local" components="{dmxBootstrap5Modal:{},dmxFormatter:{}}" -->

<style>
    /* Estilo para imagem de perfil no modal QR Code */
    .profile-image {
        width: 100%;
        max-width: 120px;
        height: auto;
        max-height: 150px;
        border-radius: 8px;
        object-fit: cover;
        border: 4px solid #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 1rem;
        display: block;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        margin-left: auto;
        margin-right: auto;
        position: relative;
    }

    .profile-image::before {
        content: "üì∑";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1rem;
        color: #1976d2;
        z-index: 1;
    }

    .profile-image[src]:not([src=""]):not([src*="data:"]) {
        background: none;
    }

    .profile-image[src]:not([src=""]):not([src*="data:"])::before {
        display: none;
    }

    /* Quando a imagem carrega com sucesso, remove o placeholder */
    .profile-image.loaded {
        background: none;
    }

    .profile-image.loaded::before {
        display: none;
    }

    .qr-code-image {
        width: 100%;
        max-width: 200px;
        height: auto;
        margin-left: auto;
        margin-right: auto;
        display: block;
    }
</style>

<dmx-serverconnect id="buscar_qrcode" url="/api/colaborador/indentificar-colaborador-cpf" noload="true"></dmx-serverconnect>
<div class="modal" id="modal1" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Meu QRCODE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form1.reset()"></button>
            </div>
            <div class="modal-body text-center">
                <form id="form1">
                    <div class="form-group mb-3"> <label for="cpf" class="form-label">Insira seu CPF</label>
                        <input type="text" class="form-control" id="cpf" name="cpf" aria-describedby="input1_help" placeholder="XXX.XXX.XXX-XX">
                    </div>
                </form>
                <div dmx-show="!buscar_qrcode.data.query.isEmpty()">
                    <h6 class="text-center mb-3">{{buscar_qrcode.data.query.nome_colaborador}}</h6>

                    <!-- Debug: mostrar caminho original e processado -->
                    <div class="alert alert-info small text-start mb-3">
                        <strong>Debug - Caminhos testados:</strong><br>
                        Original: {{buscar_qrcode.data.query.imagem_perfil}}<br>
                        Teste 1: {{buscar_qrcode.data.query.imagem_perfil.replace('/public', '')}}<br>
                        Teste 2: {{'./' + buscar_qrcode.data.query.imagem_perfil.replace('/public/', '')}}<br>
                        Teste 3: {{'../' + buscar_qrcode.data.query.imagem_perfil.replace('/public/', '')}}<br>
                        Teste 4: {{'https://sgi.rodriguescolchoes.com.br' + buscar_qrcode.data.query.imagem_perfil.replace('/public', '')}}<br>
                        Teste 5: {{'https://sgi.rodriguescolchoes.com.br' + buscar_qrcode.data.query.imagem_perfil}}<br>
                        Teste 6: {{buscar_qrcode.data.query.imagem_perfil.replace('/public/', '../public/')}}<br>
                    </div>

                    <!-- Primeira linha de testes -->
                    <div class="row mb-3">
                        <div class="col-2">
                            <p class="small">Teste 1: Remove /public</p>
                            <img dmx-bind:src="buscar_qrcode.data.query.imagem_perfil.replace('/public', '')" class="profile-image" alt="Teste 1" onload="console.log('‚úÖ Teste 1 funcionou:', this.src);" onerror="console.log('‚ùå Teste 1 falhou:', this.src);">
                        </div>
                        <div class="col-2">
                            <p class="small">Teste 2: ./</p>
                            <img dmx-bind:src="'./' + buscar_qrcode.data.query.imagem_perfil.replace('/public/', '')" class="profile-image" alt="Teste 2" onload="console.log('‚úÖ Teste 2 funcionou:', this.src);" onerror="console.log('‚ùå Teste 2 falhou:', this.src);">
                        </div>
                        <div class="col-2">
                            <p class="small">Teste 3: ../</p>
                            <img dmx-bind:src="'../' + buscar_qrcode.data.query.imagem_perfil.replace('/public/', '')" class="profile-image" alt="Teste 3" onload="console.log('‚úÖ Teste 3 funcionou:', this.src);" onerror="console.log('‚ùå Teste 3 falhou:', this.src);">
                        </div>
                        <div class="col-3">
                            <p class="small">Teste 4: Dom√≠nio + sem /public</p>
                            <img dmx-bind:src="'https://sgi.rodriguescolchoes.com.br' + buscar_qrcode.data.query.imagem_perfil.replace('/public', '')" class="profile-image" alt="Teste 4" onload="console.log('‚úÖ Teste 4 funcionou:', this.src);" onerror="console.log('‚ùå Teste 4 falhou:', this.src);">
                        </div>
                        <div class="col-3">
                            <p class="small">Teste 5: Dom√≠nio + direto</p>
                            <img dmx-bind:src="'https://sgi.rodriguescolchoes.com.br' + buscar_qrcode.data.query.imagem_perfil" class="profile-image" alt="Teste 5" onload="console.log('‚úÖ Teste 5 funcionou:', this.src);" onerror="console.log('‚ùå Teste 5 falhou:', this.src);">
                        </div>
                    </div>

                    <!-- Segunda linha de testes -->
                    <div class="row mb-3">
                        <div class="col-2">
                            <p class="small">Teste 6: ../public/</p>
                            <img dmx-bind:src="buscar_qrcode.data.query.imagem_perfil.replace('/public/', '../public/')" class="profile-image" alt="Teste 6" onload="console.log('‚úÖ Teste 6 funcionou:', this.src);" onerror="console.log('‚ùå Teste 6 falhou:', this.src);">
                        </div>
                        <div class="col-2">
                            <p class="small">Teste 7: Caminho direto</p>
                            <img dmx-bind:src="buscar_qrcode.data.query.imagem_perfil" class="profile-image" alt="Teste 7" onload="console.log('‚úÖ Teste 7 funcionou:', this.src);" onerror="console.log('‚ùå Teste 7 falhou:', this.src);">
                        </div>
                        <div class="col-2">
                            <p class="small">Teste 8: Fixo ../</p>
                            <img src="../upload/perfil/004.934.252-50._1.jpg" class="profile-image" alt="Teste 8" onload="console.log('‚úÖ Teste 8 funcionou:', this.src);" onerror="console.log('‚ùå Teste 8 falhou:', this.src);">
                        </div>
                        <div class="col-3">
                            <p class="small">Teste 9: Fixo dom√≠nio</p>
                            <img src="https://sgi.rodriguescolchoes.com.br/upload/perfil/004.934.252-50._1.jpg" class="profile-image" alt="Teste 9" onload="console.log('‚úÖ Teste 9 funcionou:', this.src);" onerror="console.log('‚ùå Teste 9 falhou:', this.src);">
                        </div>
                        <div class="col-3">
                            <p class="small">Teste 10: Fixo dom√≠nio + /public</p>
                            <img src="https://sgi.rodriguescolchoes.com.br/public/upload/perfil/004.934.252-50._1.jpg" class="profile-image" alt="Teste 10" onload="console.log('‚úÖ Teste 10 funcionou:', this.src);" onerror="console.log('‚ùå Teste 10 falhou:', this.src);">
                        </div>
                    </div>

                    <hr class="my-4">

                    <img dmx-bind:src="'data:image/png;base64,' + buscar_qrcode.data.query.base64" class="qr-code-image mb-3" alt="QR Code de Acesso" onload="this.style.display='block';" onerror="this.style.display='none';">

                    <p class="text-muted small mt-2">Apresente este QR Code no acesso</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form1.reset()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="buscar_qrcode.load({cpf: form1.cpf.value})">Ver meu QRCODE</button>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid pt-3 ps-4 pe-4">
    <div class="row h-100 justify-content-center align-items-center bg-light rounded-4 py-5">
        <div class="col-md-9 text-center">
            <h1 class="mb-3">Bem-vindo ao Futuro da Gest√£o na Rodrigues Colch√µes</h1>
            <p class="fs-4">Um novo sistema que reflete nosso compromisso com a inova√ß√£o, a efici√™ncia e o crescimento sustent√°vel. Porque evoluir faz parte da nossa ess√™ncia.</p>
            <button id="btn1" class="btn btn-primary" dmx-on:click="navegacao.goto('/f/criar-conta',true)">Crie sua conta</button>
            <button id="btn2" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal1">Ver meu QRCODE</button>
        </div>
    </div>
</div>
<script>
    document.getElementById('cpf').addEventListener('input', function(e) {
    let value = e.target.value;
    // Remove tudo que n√£o √© d√≠gito
    value = value.replace(/\D/g, '');
    
    // Limita a 11 d√≠gitos
    value = value.substring(0, 11);
    
    // Aplica a m√°scara
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    
    // Atualiza o valor no campo
    e.target.value = value;
});

document.getElementById('cpf').addEventListener('keypress', function(e) {
    // Permite apenas n√∫meros
    if (!/\d/.test(String.fromCharCode(e.keyCode))) e.preventDefault();
});
</script>
<meta name="ac:route" content="/">